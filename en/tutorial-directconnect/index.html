
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://awslabs.github.io/data-transfer-hub/tutorial-directconnect/">
      
      <link rel="icon" href="../images/aws-solutions.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.3">
    
    
      
        <title>Transfer S3 object via Direct Connect - Data Transfer Hub</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.edf004c2.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#use-dth-to-transfer-data-via-dx-in-a-non-isolated-network" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Data Transfer Hub" class="md-header__button md-logo" aria-label="Data Transfer Hub" data-md-component="logo">
      
  <img src="../images/aws-solutions.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Data Transfer Hub
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Transfer S3 object via Direct Connect
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="/data-transfer-hub/en/" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/data-transfer-hub/zh/" hreflang="zh-CN" class="md-select__link">
                    简体中文
                  </a>
                </li>
                
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/awslabs/data-transfer-hub/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Data Transfer Hub" class="md-nav__button md-logo" aria-label="Data Transfer Hub" data-md-component="logo">
      
  <img src="../images/aws-solutions.png" alt="logo">

    </a>
    Data Transfer Hub
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/awslabs/data-transfer-hub/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cost/" class="md-nav__link">
        Cost
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../solution-components/" class="md-nav__link">
        Solution components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        Security
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../regions/" class="md-nav__link">
        Supported regions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../template/" class="md-nav__link">
        CloudFormation template
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        Automated deployment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-s3/" class="md-nav__link">
        Create Amazon S3 transfer task
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-ecr/" class="md-nav__link">
        Create Amazon ECR transfer task
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_11">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-oss/" class="md-nav__link">
        Transfer S3 object from Alibaba Cloud OSS
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Transfer S3 object via Direct Connect
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Transfer S3 object via Direct Connect
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#use-dth-to-transfer-data-via-dx-in-a-non-isolated-network" class="md-nav__link">
    Use DTH to transfer data via DX in a non-isolated network 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-dth-to-transfer-data-via-dx-in-an-isolated-network" class="md-nav__link">
    Use DTH to transfer data via DX in an isolated network 
  </a>
  
    <nav class="md-nav" aria-label="Use DTH to transfer data via DX in an isolated network ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-the-dth-s3-plugin" class="md-nav__link">
    Deploy the DTH S3-Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-ec2-userdata-for-worker-nodes-and-finder-node" class="md-nav__link">
    Update the EC2 Userdata for worker nodes and finder node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    Architecture
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../additional-resources/" class="md-nav__link">
        Additional resources
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../uninstall/" class="md-nav__link">
        Uninstall the solution
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../source/" class="md-nav__link">
        Source code
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../revisions/" class="md-nav__link">
        Revisions
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#use-dth-to-transfer-data-via-dx-in-a-non-isolated-network" class="md-nav__link">
    Use DTH to transfer data via DX in a non-isolated network 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-dth-to-transfer-data-via-dx-in-an-isolated-network" class="md-nav__link">
    Use DTH to transfer data via DX in an isolated network 
  </a>
  
    <nav class="md-nav" aria-label="Use DTH to transfer data via DX in an isolated network ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-the-dth-s3-plugin" class="md-nav__link">
    Deploy the DTH S3-Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-ec2-userdata-for-worker-nodes-and-finder-node" class="md-nav__link">
    Update the EC2 Userdata for worker nodes and finder node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    Architecture
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/awslabs/data-transfer-hub/edit/master/docs/tutorial-directconnect.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


  <h1>Transfer S3 object via Direct Connect</h1>

<p>This tutorial describes how to use Data Transfer Hub (DTH) via Direct Connect (DX).</p>
<p>When DTH worker node and finder node start to work, they need to download related assets (such as CloudWatch agent, DTH CLI) from internet by default. In an isolated network, you need to manually download and upload these files to an S3 bucket in the region where DTH is deployed.</p>
<p>You have two options to use DTH to transfer data via DX:</p>
<ul>
<li><a href="#non-isolated-network">Use DTH to transfer data via DX in a non-isolated network</a></li>
<li><a href="#isolated-network">Use DTH to transfer data via DX in an isolated network</a></li>
</ul>
<h2 id="use-dth-to-transfer-data-via-dx-in-a-non-isolated-network">Use DTH to transfer data via DX in a non-isolated network <a name="non-isolated-network"></a></h2>
<p>In this scenario, DTH is deployed in the <strong>destination side</strong> and within a VPC with <strong>public access</strong> (has Internet Gateway or NAT), and the source bucket is in the isolated network.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As DTH deployment VPC has public internet access (IGW or NAT), EC2 worker/finder nodes can access other AWS services used by DTH such as secret managers and download related assets (such as CloudWatch agent, DTH CLI) from internet without any changes.</p>
</div>
<ol>
<li>
<p>From the <strong>Create Transfer Task</strong> page, select <strong>Create New Task</strong>, and then select <strong>Next</strong>.</p>
</li>
<li>
<p>From the <strong>Engine options</strong> page, under engine, select <strong>Amazon S3</strong>, and then choose <strong>Next Step</strong>.</p>
</li>
<li>
<p>Specify the transfer task details.</p>
<ul>
<li>Under <strong>Source Type</strong>, select the data source <strong>Amazon S3 Compatible Storage</strong>. </li>
</ul>
</li>
<li>
<p>Enter <strong>endpoint url</strong>, which must be the <strong>interface endpoint</strong> url, such as <code>https://bucket.vpce-076205013d3a9a2ca-us23z2ze.s3.ap-east-1.vpce.amazonaws.com</code>. You can find the specific url in <a href="https://us-east-1.console.aws.amazon.com/vpc/home?region=us-west-2#Endpoints:vpcEndpointType=Interface">VPC Endpoint Console</a> DNS names part.</p>
</li>
<li>
<p>Enter <strong>bucket name</strong> and choose to sync <strong>Full Bucket</strong> or <strong>Objects with a specific prefix</strong> or <strong>Objects with different prefixes</strong>.</p>
</li>
<li>
<p>Provide destination settings for the S3 buckets. </p>
</li>
<li>
<p>From <strong>Engine settings</strong>, verify the values and modify them if necessary. For incremental data transfer, we recommend to set the <strong>minimum capacity</strong> to at least 1.</p>
</li>
<li>
<p>At <strong>Task Scheduling Settings</strong>, select your task scheduling configuration.</p>
<ul>
<li>If you want to configure the timed task at a fixed frequency to compare the data difference on both sides of the time, select <strong>Fixed Rate</strong>.</li>
<li>If you want to configure a scheduled task through <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html#CronExpressions">Cron Expression</a> to achieve a scheduled comparison of data differences on both sides, select <strong>Cron Expression</strong>.</li>
<li>If you only want to perform the data synchronization task once, select <strong>One Time Transfer</strong>.</li>
</ul>
</li>
<li>
<p>For <strong>Advanced Options</strong>, keep the default values.</p>
</li>
<li>
<p>At <strong>Need Data Comparison before Transfer</strong>, select your task configuration.</p>
<ul>
<li>If you want to skip the data comparison process and transfer all files, select <strong>No</strong>.</li>
<li>If you only want to synchronize files with differences, select <strong>Yes</strong>.</li>
</ul>
</li>
<li>
<p>In <strong>Alarm Email</strong>, provide an email address.</p>
</li>
<li>
<p>Choose <strong>Next</strong> and review your task parameter details. </p>
</li>
<li>
<p>Choose <strong>Create Task</strong>. </p>
</li>
</ol>
<h2 id="use-dth-to-transfer-data-via-dx-in-an-isolated-network">Use DTH to transfer data via DX in an isolated network <a name="isolated-network"></a></h2>
<p>In this scenario, DTH is deployed in the <strong>destination side</strong> and within a VPC <strong>without public access</strong> (isolated VPC), and the source bucket is also in an isolated network.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p><strong>Configure the service endpoints for VPC</strong></p>
<p>DTH worker/finder nodes need to access other AWS services. To do so, you need to create <strong>Gateway Endpoint</strong> for <strong>DynamoDB</strong> and <strong>S3</strong>, create <strong>Interface Endpoint</strong> for <strong>logs</strong>, <strong>SQS</strong> and <strong>Secret Managers</strong>.</p>
<p><img alt="endpoints" src="../images/dx-vpc-endpoints.png" /></p>
<p><strong>Upload the artifacts to an S3 bucket</strong></p>
<p>In an isolated network, do the following to manually download and upload files to an S3 bucket in the region where DTH is deployed.</p>
<ol>
<li>
<p>Download <a href="https://s3.amazonaws.com/amazoncloudwatch-agent/amazon_linux/arm64/latest/amazon-cloudwatch-agent.rpm">Amazon CloudWatch Agent</a> and <a href="https://aws-gcr-solutions.s3.amazonaws.com/data-transfer-hub-s3/latest/drhcli_1.0.1_linux_arm64.tar.gz">DTH CLI</a>.</p>
</li>
<li>
<p>Create the worker's CloudWatch Agent Config file. You can create a file named <code>cw_agent_config.json</code>.
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;agent&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;metrics_collection_interval&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="nt">&quot;run_as_user&quot;</span><span class="p">:</span> <span class="s2">&quot;root&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;logs&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;logs_collected&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;files&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;collect_list&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/home/ec2-user/worker.log&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;log_group_name&quot;</span><span class="p">:</span> <span class="s2">&quot;##log group##&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;log_stream_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Instance-{instance_id}&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;metrics&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;append_dimensions&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AutoScalingGroupName&quot;</span><span class="p">:</span> <span class="s2">&quot;${aws:AutoScalingGroupName}&quot;</span><span class="p">,</span>
            <span class="nt">&quot;InstanceId&quot;</span><span class="p">:</span> <span class="s2">&quot;${aws:InstanceId}&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;aggregation_dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;AutoScalingGroupName&quot;</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="nt">&quot;metrics_collected&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;disk&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;measurement&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;used_percent&quot;</span>
                <span class="p">],</span>
                <span class="nt">&quot;metrics_collection_interval&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                <span class="nt">&quot;resources&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;*&quot;</span>
                <span class="p">]</span>
            <span class="p">},</span>
            <span class="nt">&quot;mem&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;measurement&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;mem_used_percent&quot;</span>
                <span class="p">],</span>
                <span class="nt">&quot;metrics_collection_interval&quot;</span><span class="p">:</span> <span class="mi">60</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>Upload these three files to an S3 bucket in the region where DTH is deployed.</li>
</ol>
<p><img alt="assets" src="../images/dx-s3-assets.png" /></p>
<h3 id="deploy-the-dth-s3-plugin">Deploy the DTH S3-Plugin</h3>
<p>We recommend using the <strong>DTH S3-plugin</strong> to create the transfer task, instead of using the DTH console.</p>
<p><strong>For AWS China Regions</strong></p>
<p><a href="https://console.amazonaws.cn/cloudformation/home#/stacks/create/template?stackName=DTHS3Stack&amp;templateURL=https://aws-gcr-solutions.s3.cn-north-1.amazonaws.com.cn/data-transfer-hub-s3/latest/DataTransferS3Stack-ec2.template"><img alt="Launch Stack" src="../images/launch-stack.png" /></a></p>
<p><strong>For AWS Global Regions</strong></p>
<p><a href="https://console.aws.amazon.com/cloudformation/home#/stacks/create/template?stackName=DTHS3Stack&amp;templateURL=https://aws-gcr-solutions.s3.amazonaws.com/data-transfer-hub-s3/latest/DataTransferS3Stack-ec2.template"><img alt="Launch Stack" src="../images/launch-stack.png" /></a></p>
<ol>
<li>
<p>For <strong>Source Type</strong>, choose <strong>Amazon_S3</strong>.</p>
</li>
<li>
<p>Enter the <strong>Source Bucket</strong> name.</p>
</li>
<li>
<p>Enter the <strong>Source Prefix</strong> if needed.</p>
</li>
<li>
<p>Enter the <strong>Source Endpoint URL</strong>. For example, <code>https://bucket.vpce-076205013d3a9a2ca-us23z2ze.s3.ap-east-1.vpce.amazonaws.com</code>.</p>
</li>
<li>
<p>For <strong>Source In Current Account</strong>, choose <strong>false</strong>.</p>
</li>
<li>
<p>For <strong>Source Credentials</strong>, enter the secret's name stored in the <a href="https://console.aws.amazon.com/secretsmanager/home">Secrets Manager</a>.</p>
</li>
<li>
<p>For <strong>Enable S3 Event</strong>, choose <strong>No</strong>.</p>
</li>
<li>
<p>Configure the <strong>Destination Bucket</strong>, <strong>Destination Prefix</strong>, <strong>Destination Region</strong> and <strong>Destination in Current Account</strong>. Leave the Destination Credentials blank if the destination bucket is in current account.</p>
</li>
<li>
<p>Configure the <strong>Alarm Email</strong>.</p>
</li>
<li>
<p>Configure the <strong>VPC ID</strong> and <strong>Subnet IDs</strong>.</p>
</li>
<li>
<p>For other parameters, keep the default values and choose <strong>Next</strong>.</p>
</li>
<li>
<p>Choose <strong>Next</strong>. Configure additional stack options such as tags (Optional). </p>
</li>
<li>
<p>Choose <strong>Next</strong>. Review and confirm acknowledgement, then choose <strong>Create Stack</strong> to start the deployment.</p>
</li>
</ol>
<p>The deployment will take approximately 3 to 5 minutes.</p>
<h3 id="update-the-ec2-userdata-for-worker-nodes-and-finder-node">Update the EC2 Userdata for worker nodes and finder node</h3>
<p><strong>Update worker nodes' Userdata</strong></p>
<ol>
<li>
<p>Go to the Auto Scaling Group's <a href="https://us-west-2.console.aws.amazon.com/ec2/v2/home?region=us-west-2#LaunchConfigurations:launchConfigurationName=">Launch configurations</a>.</p>
</li>
<li>
<p>Select the configuration and choose <strong>Copy Launch Configuration</strong>.</p>
</li>
<li>
<p>Edit the <strong>User data</strong> under the <strong>Advanced details</strong> section.</p>
<ul>
<li>Replace the code above <code>echo "export JOB_TABLE_NAME=xxxxxxxxxxx" &gt;&gt; env.sh</code> with the following shell script.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

yum update -y
<span class="nb">cd</span> /home/ec2-user/
<span class="nv">asset_bucket</span><span class="o">=</span>&lt;asset_bucket_name&gt;
aws s3 cp <span class="s2">&quot;s3://</span><span class="nv">$asset_bucket</span><span class="s2">/cw_agent_config.json&quot;</span> . --region &lt;deploy_region_name&gt;
aws s3 cp <span class="s2">&quot;s3://</span><span class="nv">$asset_bucket</span><span class="s2">/amazon-cloudwatch-agent.rpm&quot;</span> .  --region &lt;deploy_region_name&gt;
aws s3 cp <span class="s2">&quot;s3://</span><span class="nv">$asset_bucket</span><span class="s2">/dthcli_1.0.1_linux_arm64.tar.gz&quot;</span> .  --region &lt;deploy_region_name&gt;

sudo yum install -y amazon-cloudwatch-agent.rpm
sed -i  -e <span class="s2">&quot;s/##log group##/&lt;worker_log_group_name&gt;/g&quot;</span> cw_agent_config.json
/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -a fetch-config -m ec2 -c file:/home/ec2-user/cw_agent_config.json -s
tar zxvf dthcli_1.0.1_linux_arm64.tar.gz
</code></pre></div>
<ul>
<li>
<p>Replace the <code>&lt;asset_bucket_name&gt;</code> with your specific bucket name where the assets are stored. </p>
</li>
<li>
<p>Replace the <code>&lt;deploy_region_name&gt;</code> with the region where you deploy the DTH S3-Plugin solution.</p>
</li>
<li>
<p>Replace the <code>&lt;worker_log_group_name&gt;</code> with the DTH Worker's log group name.</p>
</li>
<li>
<p>Do not edit the code behind <code>echo "export JOB_TABLE_NAME=xxxxxxxxxxx" &gt;&gt; env.sh</code>.</p>
</li>
</ul>
</li>
<li>
<p>Choose <strong>Create Launch Configuration</strong>.</p>
</li>
<li>
<p>Go to <a href="https://us-west-2.console.aws.amazon.com/ec2/v2/home?region=us-west-2#AutoScalingGroups:">Auto Scaling Group</a>.</p>
</li>
<li>
<p>Choose the specific scaling group and click <strong>Edit</strong>.</p>
</li>
<li>
<p>In the <strong>Launch configuration</strong> section, choose the new launch configuration created in the previous step. Click <strong>Update</strong>.</p>
</li>
<li>
<p>Terminate all the running DTH worker node, and the Auto Scaling Group will launch the new worker node with the new Userdata.</p>
</li>
</ol>
<p><strong>Update finder nodes' Userdata</strong></p>
<ol>
<li>
<p>Go to the EC2 <a href="https://us-west-2.console.aws.amazon.com/ec2/v2/home?region=us-west-2#LaunchTemplates:">Launch Templates</a>.</p>
</li>
<li>
<p>Click <strong>Modify template</strong>.</p>
</li>
<li>
<p>Edit the <strong>User data</strong> under the <strong>Advanced details</strong> section.</p>
<ul>
<li>Replace the code above <code>echo "export JOB_TABLE_NAME=xxxxxxxxxxx" &gt;&gt; env.sh</code> using the shell script bellow.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

yum update -y
<span class="nb">cd</span> /home/ec2-user/
<span class="nv">asset_bucket</span><span class="o">=</span>&lt;asset_bucket_name&gt;
aws s3 cp <span class="s2">&quot;s3://</span><span class="nv">$asset_bucket</span><span class="s2">/amazon-cloudwatch-agent.rpm&quot;</span> .  --region &lt;deploy_region_name&gt;
aws s3 cp <span class="s2">&quot;s3://</span><span class="nv">$asset_bucket</span><span class="s2">/dthcli_1.0.1_linux_arm64.tar.gz&quot;</span> .  --region &lt;deploy_region_name&gt;

<span class="nb">echo</span> <span class="s2">&quot;{\&quot;agent\&quot;: {\&quot;metrics_collection_interval\&quot;: 60,\&quot;run_as_user\&quot;: \&quot;root\&quot;},\&quot;logs\&quot;: {\&quot;logs_collected\&quot;: {\&quot;files\&quot;: {\&quot;collect_list\&quot;: [{\&quot;file_path\&quot;: \&quot;/home/ec2-user/finder.log\&quot;,\&quot;log_group_name\&quot;: \&quot;##log group##\&quot;}]}}}}&quot;</span> &gt;&gt; /home/ec2-user/cw_agent_config.json,

sudo yum install -y amazon-cloudwatch-agent.rpm

sed -i  -e <span class="s2">&quot;s/##log group##/&lt;finder_log_group_name&gt;`/g&quot;</span> cw_agent_config.json
/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -a fetch-config -m ec2 -c file:/home/ec2-user/cw_agent_config.json -s
tar zxvf dthcli_1.0.1_linux_arm64.tar.gz
</code></pre></div>
<ul>
<li>
<p>Replace the <code>&lt;asset_bucket_name&gt;</code> with your specific bucket name where the assets are stored. </p>
</li>
<li>
<p>Replace the <code>&lt;deploy_region_name&gt;</code> with the region where you deploy the DTH S3-Plugin solution.</p>
</li>
<li>
<p>Replace the <code>&lt;finder_log_group_name&gt;</code> with the DTH Finder's log group name.</p>
</li>
<li>
<p>Do not edit the code behind <code>echo "export JOB_TABLE_NAME=xxxxxxxxxxx" &gt;&gt; env.sh</code>.</p>
</li>
</ul>
</li>
<li>
<p>Choose <strong>Create template version</strong>.</p>
</li>
<li>
<p>Use this new version template to launch a new Finder Node, and manually terminate the old one.</p>
</li>
</ol>
<h2 id="architecture">Architecture</h2>
<p><a href="../images/dx-arch-global.png"><img alt="architecture" src="../images/dx-arch-global.png" /></a></p>
<p>DTH worker nodes running on EC2 transfer data from bucket in one AWS account to bucket in another AWS account.</p>
<ul>
<li>To access bucket in the account where DTH is deployed, DTH worker nodes use <strong>S3 Gateway Endpoint</strong></li>
<li>To access bucket in another account, DTH worker nodes use <strong>S3 Private Link</strong> by <strong>S3 Interface Endpoint</strong></li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../tutorial-oss/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Transfer S3 object from Alibaba Cloud OSS" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Transfer S3 object from Alibaba Cloud OSS
            </div>
          </div>
        </a>
      
      
        
        <a href="../additional-resources/" class="md-footer__link md-footer__link--next" aria-label="Next: Additional resources" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Additional resources
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["tabs", "search.suggest", "search.highlight"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.0bbba5b5.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.e1a181d9.min.js"></script>
      
    
  </body>
</html>